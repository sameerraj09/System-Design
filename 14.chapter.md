# **System Design â€“ YouTube (Chapter 14)**  
                          ![image](https://github.com/user-attachments/assets/cf44730f-46ba-4044-a7fe-87b40d5c3e34)

## **Introduction**  
- **YouTube** is a video-sharing platform where users **upload, watch, and interact** with videos.  
- Similar systems: **Netflix, Hulu, Vimeo**.  
- **Key Statistics (2020)**:  
  - **2 billion monthly users**, **5 billion videos watched per day**.  
  - **50M+ content creators**, available in **80+ languages**.  
  - **37% of mobile internet traffic** is from YouTube.  

---

## **Step 1: Understanding the Problem & Scope**  
### **Key Questions to Clarify Requirements**  
| **Question** | **Answer** |
|-------------|-----------|
| **Core features?** | Video upload & streaming |
| **Supported devices?** | Mobile apps, web browsers, smart TVs |
| **Daily Active Users (DAU)?** | 5 million |
| **Average watch time per day?** | 30 minutes |
| **International users?** | Yes |
| **Supported video resolutions?** | Most formats supported |
| **File size limit?** | 1GB per video |
| **Use of cloud services?** | Yes, leverage AWS, Google Cloud, or Azure |

### **System Requirements**
âœ” **Fast video uploads**.  
âœ” **Smooth video playback**.  
âœ” **Adaptive video quality** (low/high resolutions).  
âœ” **Low infrastructure cost**.  
âœ” **High availability & scalability**.  

---

## **Back-of-the-Envelope Estimation**
ðŸ“Œ **Traffic Calculation**  
- **5M DAU, each watches 5 videos/day** â†’ **25M video views/day**.  
- **10% of users upload 1 video/day** â†’ **500K new videos daily**.  
- **Avg. video size: 300MB**.  
- **Total daily storage:**
  ```
  500K videos * 300MB = 150TB/day
  ```

ðŸ“Œ **CDN Cost Estimation**  
- **Streaming cost (AWS CloudFront CDN, $0.02/GB):**  
  ```
  5M users * 5 videos * 0.3GB * $0.02 = $150,000/day
  ```
ðŸš¨ **High cost** â†’ Needs **cost optimization strategies** (covered later).  

---

## **Step 2: High-Level Design**
ðŸ“Œ **Key Components (Figure 14-3)**  
1. **Clients** â†’ Mobile, web, smart TVs.  
2. **CDN** â†’ Caches & delivers videos to users.  
3. **API Servers** â†’ Handles user requests **(upload, metadata, search, recommendations, etc.)**.  

![image](https://github.com/user-attachments/assets/2d3db1be-8db0-4ab4-9aa2-9a223850a192)

---

### **Video Uploading Flow (Figure 14-4)**
ðŸ“Œ **Steps**  
1. **User uploads a video** â†’ Request goes to **API servers via Load Balancer**.  
2. **API servers store metadata** (title, duration, user info) in **Metadata DB & Cache**.  
3. **Video is stored in Blob Storage (Original Storage)**.  
4. **Transcoding servers convert video** into different formats & resolutions.  
5. **Transcoded video is stored in Transcoded Storage & distributed via CDN**.  
6. **Completion handler updates metadata** & **notifies user** when the video is ready.  

![image](https://github.com/user-attachments/assets/4c96c871-dee8-4bc3-9d3c-02964ce1e8bf)


ðŸ“Œ **Key Components**  
âœ” **Metadata Cache** â†’ Stores frequently accessed metadata for fast retrieval.  
âœ” **Completion Queue** â†’ Ensures metadata is updated **only after transcoding is complete**.  

---

### **Video Streaming Flow (Figure 14-7)**
ðŸ“Œ **Steps**  
1. **User clicks Play** â†’ Request goes to **CDN**.  
2. **CDN streams video** in chunks (no full download needed).  
3. **Adaptive Streaming**:  
   - **High-quality video for fast networks**.  
   - **Low-quality video for slow networks**.  

![image](https://github.com/user-attachments/assets/42f162b2-1afd-4802-9a19-d024472dcb7e)

ðŸ“Œ **Streaming Protocols**  
- **MPEG-DASH** (Dynamic Adaptive Streaming over HTTP).  
- **HLS** (HTTP Live Streaming, used by Apple).  
- **Smooth Streaming (Microsoft), HDS (Adobe)**.  

ðŸš€ **Key Benefit** â†’ **Video starts instantly** without waiting for full download.  

---

## **Step 3: Design Deep Dive**
### **Video Transcoding (Figure 14-8)**
ðŸ“Œ **Why is transcoding needed?**  
âœ” **Reduces file size** â†’ Saves storage.  
âœ” **Makes video playable on different devices**.  
âœ” **Enables adaptive quality switching**.  

![image](https://github.com/user-attachments/assets/7c4663a4-de6c-4d33-bda1-2e7b191d8185)

ðŸ“Œ **Components**  
1. **Preprocessor** â†’ Splits video into **smaller chunks (GOP: Group of Pictures)**.  
2. **DAG Scheduler** â†’ Manages transcoding pipeline using **Directed Acyclic Graph (DAG)**.  
3. **Task Workers** â†’ Process **video encoding, thumbnails, watermarks**.  
4. **Temporary Storage** â†’ Stores intermediate files **before final encoding**.  
5. **Encoded Video Storage** â†’ Final output stored in Blob Storage.  

ðŸ“Œ **Parallel Processing Optimization (Figure 14-9)**  
- **Split video into chunks** â†’ Encode in parallel â†’ Faster processing.  

![image](https://github.com/user-attachments/assets/11183e29-dd36-42ae-a707-aabf616090d1)

---

### **System Optimizations**
ðŸ“Œ **Speed Optimizations**  
âœ” **Parallel Uploads (Figure 14-22)** â†’ Upload video in chunks instead of as a full file.  
![image](https://github.com/user-attachments/assets/2faf612c-5e87-4749-b867-24ed1e41c0e2)

âœ” **Upload Centers (Figure 14-24)** â†’ Users upload to the nearest data center (USA, Asia, Europe).  
![image](https://github.com/user-attachments/assets/752f1fb7-2900-403d-ab35-b0806332332f)

âœ” **Parallelism Everywhere (Figure 14-25, 14-26)** â†’ Use **Message Queues** to prevent bottlenecks.  

![image](https://github.com/user-attachments/assets/e33ab845-939d-4db2-a190-40c493ccf435)
![image](https://github.com/user-attachments/assets/58b59d1d-4f7d-4a0b-ad2b-d30455eb7762)

ðŸ“Œ **Security Optimizations**  
âœ” **Pre-signed Upload URLs (Figure 14-27)** â†’ Users can only upload to **authorized locations**.  
âœ” **Video Protection** â†’ Use **DRM, AES Encryption, Visual Watermarking** to prevent piracy.  

![image](https://github.com/user-attachments/assets/999fd444-b159-4861-ba48-cc80c0856cca)


ðŸ“Œ **Cost-Saving Optimizations**  
âœ” **CDN Optimization (Figure 14-28)**  
  - **Store only popular videos in CDN**.  
  - **Less popular videos are stored in high-capacity storage**.  
âœ” **Regional Caching** â†’ Keep videos **only where they are frequently watched**.  
âœ” **Build Your Own CDN** â†’ Like Netflix's **Open Connect** to reduce dependency on cloud CDNs.  

![image](https://github.com/user-attachments/assets/2a9feb48-8992-4b55-a8ef-8ab7c7b3a4d8)

---

### **Error Handling**
ðŸ“Œ **How to handle failures?**  
| **Component** | **Error Handling Strategy** |
|--------------|--------------------------|
| **Upload Failure** | Retry a few times. |
| **Metadata DB Failure** | Use **replicated database servers**. |
| **Transcoding Failure** | Retry or log error for manual review. |
| **Preprocessor Failure** | Regenerate DAG. |
| **Worker Failure** | Assign task to a new worker. |
| **API Server Down** | Route to another API server (stateless design). |
| **Cache Server Down** | Use replicas for redundancy. |

ðŸš€ **Goal:** **Graceful degradation** â†’ If a part of the system fails, users should still have a smooth experience.  

---

## **Step 4: Wrap-Up & Further Considerations**
âœ” **Scaling the API Tier**  
   - API servers are **stateless** â†’ Can scale horizontally.  
âœ” **Scaling the Database**  
   - Use **Sharding & Replication** for performance & reliability.  
âœ” **Live Streaming**  
   - Requires **low latency** â†’ Different streaming protocols needed.  
âœ” **Video Takedowns**  
   - Detect & remove videos violating **copyright, community guidelines**.  

---

## **Final Thoughts**
- **YouTube is a massive-scale system** requiring **high availability & efficiency**.  
- **CDN & Transcoding** are the most **critical parts** of the architecture.  
- **Parallel processing & caching** ensure **fast uploads & smooth streaming**.  
- **Security & cost optimizations** are essential for **sustainable growth**.  

âœ… **A well-designed video platform delivers a seamless user experience at scale!** ðŸš€  

---

These **notes cover all topics** in a **simple, structured format**. You can **add figure numbers** where needed. Let me know if you need modifications! ðŸš€ðŸ˜ƒ
